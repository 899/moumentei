# this config needs haproxy-1.1.28 or haproxy-1.2.1

global
	log 127.0.0.1	local0
	log 127.0.0.1	local1 notice
	#log loghost	local0 info
	maxconn 4096
	#chroot /usr/share/haproxy
	user www-data
	group www-data
    nbproc 2
    pidfile /opt/nginx/logs/haproxy.pid
	daemon
	#debug
	#quiet

defaults
	log	global
	mode	http
	option	httplog
	option	dontlognull
	retries	3
	option redispatch
    option tcpka
	maxconn	2048
	contimeout	5000
	clitimeout	50000
	srvtimeout	50000
    balance roundrobin

#listen app_a_proxy 127.0.0.1:8100
  # - equal weights on all servers
  # - queue requests on HAPRoxy queue once maxconn limit on the appserver is reached
  # - minconn dynamically scales the connection concurrency (bound my maxconn) depending on size of HAProxy queue
  # - check health of app. server every 20 seconds
 
#  server a1 127.0.0.1:8010 weight 1 minconn 3 maxconn 6 check inter 20000
#  server a1 127.0.0.1:8010 weight 1 minconn 3 maxconn 6 check inter 20000
 
#listen qiushi 127.0.0.1:80
listen qiushi 0.0.0.0:80
  # - second cluster of servers, for another app or a long running tasks
  balance leastconn
  errorfile 503 /home/www/qqq/current/public/503.htm
 
  #server q0  127.0.0.1:15000 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q1  127.0.0.1:15001 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q2  127.0.0.1:15002 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q3  127.0.0.1:15003 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q4  127.0.0.1:15004 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q5  127.0.0.1:15005 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q6  127.0.0.1:15006 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q7  127.0.0.1:15007 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q8  127.0.0.1:15008 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q9  127.0.0.1:15009 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q10 127.0.0.1:15010 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q11 127.0.0.1:15011 weight 1 minconn 1 maxconn 8 check inter 40000
  #server q12 127.0.0.1:15012 weight 1 minconn 1 maxconn 8 check inter 40000
  server q1 74.117.62.162:8080 weight 3 check inter 40000
  server q2 173.212.227.178:8080 weight 7 check inter 40000
  server q2 64.120.245.144:8080 weight 7 check inter 40000

